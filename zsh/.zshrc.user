# =============================================================================
# USER CONFIGURATION
# =============================================================================
# This file contains user-specific settings, paths, aliases, and environment
# variables. It's sourced by .zshrc after Zim initialization.

# -----------------------------------------------------------------------------
# Dotfiles Directory Detection
# -----------------------------------------------------------------------------

# Detect dotfiles directory by checking common locations
if [ -z "$DOTFILES_DIR" ]; then
    # Try to detect based on this file's location
    if [ -n "$ZDOTDIR" ]; then
        export DOTFILES_DIR="$(cd "$ZDOTDIR/.." && pwd)"
    elif [ -d "$HOME/dotfiles" ]; then
        export DOTFILES_DIR="$HOME/dotfiles"
    elif [ -d "$HOME/.dotfiles" ]; then
        export DOTFILES_DIR="$HOME/.dotfiles"
    elif [ -d "$HOME/.dots" ]; then
        export DOTFILES_DIR="$HOME/.dots"
    else
        # Fallback: assume this file is in dotfiles/zsh/
        export DOTFILES_DIR="$(cd "$(dirname "${(%):-%x}")/.." && pwd 2>/dev/null || echo "$HOME/dotfiles")"
    fi
fi

# -----------------------------------------------------------------------------
# PATH Configuration
# -----------------------------------------------------------------------------

# Local binaries (for user-installed tools like JetBrains shell scripts)
export PATH="$HOME/.local/bin:$PATH"

# Yarn
export PATH="$HOME/.yarn/bin:$HOME/.config/yarn/global/node_modules/.bin:$PATH"

# PostgreSQL@15
export PATH="/opt/homebrew/opt/postgresql@15/bin:$PATH"

# -----------------------------------------------------------------------------
# NVM Configuration (Lazy Loading)
# -----------------------------------------------------------------------------

export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"

# Load lazy NVM wrapper
[ -s "$DOTFILES_DIR/utils/.lazy-nvm.sh" ] && source "$DOTFILES_DIR/utils/.lazy-nvm.sh"

# -----------------------------------------------------------------------------
# Environment Variables
# -----------------------------------------------------------------------------

export BAT_THEME="Nord"
export BUN_INSTALL="$HOME/.bun"
export OPENCODE_MODEL="gemini-2.5-pro"
export CCUSAGE_TIMEZONE="America/El_Salvador"

# -----------------------------------------------------------------------------
# Aliases
# -----------------------------------------------------------------------------

alias cdd="cd $HOME/Documents/Dev/Projects/designli/"
alias cde="cd $HOME/Documents/Dev/Projects/ese/"
alias cdcot="CD $DOTFILES_DIR"
alias gcpsql="$DOTFILES_DIR/utils/gcp-sql-proxy.sh"
alias nr="npm run"
alias pas="php artisan serve"
alias pcc="php artisan config:cache"
alias phpext="$DOTFILES_DIR/scripts/php-extensions.sh"
alias phpsetup="$DOTFILES_DIR/scripts/php-setup.sh"
alias rzsh="source $DOTFILES_DIR/zsh/.zshrc.user"
alias kc-redirect-uri="$DOTFILES_DIR/scripts/kc-redirect-uri.sh"

# -----------------------------------------------------------------------------
# Secrets (API Keys, Tokens)
# -----------------------------------------------------------------------------

# Load secrets from separate file (not tracked in git)
[ -s "$DOTFILES_DIR/zsh/.zshrc.secrets" ] && source "$DOTFILES_DIR/zsh/.zshrc.secrets"
